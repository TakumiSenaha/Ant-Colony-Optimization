# 最適解選択率の計算方法

## 概要

`optimal_solution_selection_stacked`グラフは、各世代で各パレート最適解が選択された割合を可視化します。

## 計算方法

### 基本方針

1 世代で複数のアリがゴールする場合、**1 世代で 1 つでも最適解に到達したら、その最適解のフラグを 1 にする**という方式を採用しています。

### 具体例

#### ケース 1: 1 つの最適解がある場合

- 1 世代で 10 匹のアリがゴール
- 最適解 1 に 5 匹到達
- **最適解 1 のフラグ：1**（1 つでも到達したため）

100 回のシミュレーションで、最適解 1 のフラグが立った回数をカウント：

- 例: 100 回中 80 回でフラグが立った → **80%**

#### ケース 2: 2 つの最適解がある場合

- 1 世代で 10 匹のアリがゴール
- 最適解 1 に 3 匹到達
- 最適解 2 に 2 匹到達
- **最適解 1 のフラグ：1**（1 つでも到達したため）
- **最適解 2 のフラグ：1**（1 つでも到達したため）

100 回のシミュレーションで、各最適解についてフラグが立った回数をカウント：

- 例: 最適解 1 のフラグが 100 回中 70 回立った → **70%**
- 例: 最適解 2 のフラグが 100 回中 50 回立った → **50%**

#### ケース 3: 3 つの最適解がある場合

- 1 世代で 10 匹のアリがゴール
- `ant_log = [0, 0, 1, -1, 0, 2, -1, 1, 0, -1]`
  - 最適解 0 に 4 回到達
  - 最適解 1 に 2 回到達
  - 最適解 2 に 1 回到達
- **最適解 0 のフラグ：1**（1 つでも到達したため）
- **最適解 1 のフラグ：1**（1 つでも到達したため）
- **最適解 2 のフラグ：1**（1 つでも到達したため）

100 回のシミュレーションで、各最適解についてフラグが立った回数をカウント：

- 例: 最適解 0 のフラグが 100 回中 80 回立った → **80%**
- 例: 最適解 1 のフラグが 100 回中 60 回立った → **60%**
- 例: 最適解 2 のフラグが 100 回中 40 回立った → **40%**

## 実装詳細

### コード

```python
# 各世代ごとに、各最適解への到達フラグをカウント
optimal_flags = [0] * num_optimal_solutions
for sim_log in ant_logs:
    start_index = gen_idx * num_ants
    end_index = start_index + num_ants
    generation_chunk = sim_log[start_index:end_index]

    # その世代のチャンク内で、各最適解に到達したかどうかをチェック
    # 1世代で1つでも最適解に到達したら、その最適解のフラグを1にする
    for opt_idx in range(num_optimal_solutions):
        if opt_idx in generation_chunk:
            optimal_flags[opt_idx] = 1

# 到達率に変換（%）
# 100回のシミュレーションで、各最適解についてフラグが立った回数をカウント
rates = [
    float((flag_count / num_simulations) * 100)
    for flag_count in optimal_flags
]
```

### 重要なポイント

1. **1 世代で 1 つでも最適解に到達したらフラグを立てる**

   - 1 世代で 10 匹のアリがゴールし、そのうち 1 匹でも最適解に到達したら、その最適解のフラグを 1 にする
   - 複数のアリが同じ最適解に到達していても、フラグは 1 のまま（重複カウントしない）

2. **複数の最適解に到達している場合**

   - 1 世代で複数の最適解に到達している場合、それぞれの最適解のフラグを 1 にする
   - 例: 最適解 1 に 3 匹、最適解 2 に 2 匹到達 → 最適解 1 のフラグ：1、最適解 2 のフラグ：1

3. **100 回のシミュレーションで集計**
   - 各世代について、100 回のシミュレーションで各最適解のフラグが立った回数をカウント
   - 到達率 = (フラグが立った回数 / 100) × 100

## グラフの意味

`optimal_solution_selection_stacked`グラフは、各世代で各パレート最適解が選択された割合を積み上げ棒グラフで表示します。

- **横軸**: 世代
- **縦軸**: 最適解選択率（%）
- **積み上げ**: 各最適解への選択率を色分けして表示

### 評価方法

- 各最適解への選択率が高いほど良い
- 上位の最適解（Solution 1, 2, 3...）が高い割合を占めていれば成功
- 例: Solution 1〜4 が合計で 80%以上を占めていれば良い

## 注意点

- `optimal_selection_rate`グラフは生成されません（削除されました）
- `optimal_solution_selection_stacked`のみを使用します
- この計算方法により、各世代で各最適解が選択された割合を正確に可視化できます
